pipeline {
    agent any 
    stages {
        stage('Preparation') {                  
                steps {
                    deleteDir()
                    git 'https://github.com/jhipster/jhipster-sample-app'
                }
        }
        stage('Build') {
                steps {
                    sh './mvnw clean package -Pprod -DskipTests'
                }                  
        }
        stage('Test') {
                steps {
                    sh './mvnw clean test'
                    sh './mvnw gatling:execute'
                }                  
        }              
    }
    post {
        always {
            gatlingArchive()
            step( [ $class: 'JacocoPublisher' ] )
        }
    }
}